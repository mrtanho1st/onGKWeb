<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·ªè h√†ng</title>
    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <script src="../js/jquery-3.7.1.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="../css/shoppingCart.css">
</head>
<body>
    <div class="wrapper">
        <header>
            <div class="wrapper">
                <header>
                    <div class="induction">
                        <div class="mail">
                            <img src="../img/mail.png">
                            <p>tan2005tg@gmail.com</p>
                        </div>
                        <div class="numphone">
                            <img src="../img/phone.png">
                            <p>034 9099 412</p>
                        </div>
                        <div id="enter">
                            <button type="button" class="btn-outline-success" data-toggle="modal" data-target="#login">
                                ƒêƒÉng nh·∫≠p
                            </button>
                        </div>
                        <div id="signin">
                            <button type="button" class="btn-outline-success" data-toggle="modal" data-target="#register">
                                ƒêƒÉng k√Ω
                            </button>
                        </div>
                        <div id="dashboard">
                            <div id="welcome">
                                <h3>Welcome: <span id="welcome-user">!</span></h3>
                            </div>
                            <div id="dashboard-btn">
                                <button onclick="logout()" class="btn-outline-warning">ƒêƒÉng xu·∫•t</button>
                            </div>
                        </div>
                    </div>
                    <!-- login -->
                    <div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                    <div class="modal-header">
                                            <h5 class="modal-title">ƒêƒÉng nh·∫≠p t√†i kho·∫£n</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                        </div>
                                <div class="modal-body">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <input type="text" id="log-username" class="form-control mb-3" placeholder="T√™n ƒëƒÉng nh·∫≠p">
                                        </div>
                                        <div class="row">
                                            <input type="password" id="log-password" class="form-control mb-3" placeholder="M·∫≠t kh·∫©u">
                                        </div>
                                        <p id="log-msg" class="mt-3"></p>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button onclick="login()" class="btn btn-primary">ƒêƒÉng nh·∫≠p</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- register -->
                    <div class="modal fade" id="register" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                    <div class="modal-header">
                                            <h5 class="modal-title">ƒêƒÉng k√Ω t√†i kho·∫£n</h5>
                                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                        </div>
                                <div class="modal-body">
                                    <div class="container-fluid">
                                        <div class="row">
                                            <input type="text" id="reg-username" class="form-control mb-3" placeholder="T√™n ƒëƒÉng nh·∫≠p">
                                        </div>
                                        <div class="row">
                                            <input type="password" id="reg-password" class="form-control mb-3" placeholder="M·∫≠t kh·∫©u">
                                        </div>
                                        <div class="row">
                                            <input type="password" id="reg-repassword" class="form-control mb-3" placeholder="Nh·∫≠p l·∫°i m·∫≠t kh·∫©u">
                                        </div>
                                        <div class="row">
                                            <h5>Nh·∫≠p th√¥ng tin c√° nh√¢n</h5>
                                        </div>
                                        <div class="row mt-2">
                                            <input type="text" id="reg-name" class="form-control mb-3" placeholder="H·ªç t√™n ng∆∞·ªùi nh·∫≠n">
                                        </div>
                                        <div class="row mt-2">
                                            <input type="email" id="reg-email" class="form-control mb-3" placeholder="ƒê·ªãa ch·ªâ email">
                                        </div>
                                        <div class="row">
                                            <input type="text" id="reg-numphone" class="form-control mb-3" placeholder="S·ªë ƒëi·ªán tho·∫°i">
                                        </div>
                                        <div class="row">
                                            <input type="text" id="reg-address" class="form-control mb-3" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n h√†ng">
                                        </div>
                                        <p id="register-msg" class="mt-3"></p>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button onclick="register()" class="btn btn-primary">ƒêƒÉng k√Ω</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                    <nav class="navbar navbar-expand-sm navbar-dark">
                        <a class="navbar-brand" href="../html/home.html"><img src="../img/logo.png" alt=""></a>
                        <button class="navbar-toggler d-lg-none" type="button" data-toggle="collapse" data-target="#collapsibleNavId" aria-controls="collapsibleNavId"
                            aria-expanded="false" aria-label="Toggle navigation"></button>
                        <div class="collapse navbar-collapse" id="collapsibleNavId">
                            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                                <li class="nav-item active">    
                                    <a class="nav-link" href="../html/home.html">TRANG CH·ª¶<span class="sr-only">(current)</span></a>
                                </li>
                                <li class="nav-item">
                                    <a href="introduce.html" class="nav-link">GI·ªöI THI·ªÜU</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="contact.html">LI√äN H·ªÜ</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="shoppingCart.html">GI·ªé H√ÄNG</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="dropdownId" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">S·∫¢N PH·∫®M</a>
                                    <div class="dropdown-menu" aria-labelledby="dropdownId">
                                        <a class="dropdown-item" href="news.html">B√°o ch√≠</a>
                                        <a class="dropdown-item" href="magazine.html">T·∫°p ch√≠</a>
                                    </div>
                                </li>
                            </ul>
                            <form class="form-inline my-2 my-lg-0">
                                <input class="form-control mr-sm-2" type="text" placeholder="Search">
                                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">T√¨m ki·∫øm</button>
                            </form>
                        </div>
                    </nav>
                </header>

        <div class="container-fluid">
            <div class="backGround">
                <img src="../img/anhNen.webp" class="img-fluid w-100" alt="·∫¢nh full width">
            </div>
            <div class="content">
                <div class="content-title">
                    <h2>Gi·ªè h√†ng c·ªßa b·∫°n</h2>
                    <img src="../img/item1.png">
                </div>
                <div class="content-represent">
                    <div id="order-message" style="margin-top: 10px; color: green;"></div>    
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√™n s·∫£n ph·∫©m</th>
                                <th>Gi√° b√°n</th>
                                <th>S·ªë l∆∞·ª£ng</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="cart-list">
                        </tbody>
                    </table>
                    <h3>T·ªïng ti·ªÅn: <span id="totalprice" class="text-danger"></span></h3>
                </div>
            </div>
            <div class="form-order mt-3">
                <button type="button" class="btn btn-success" onclick="orderCart()">ƒê·∫∑t h√†ng</button>                 
            </div>

            <!-- Modal -->
            <div class="modal fade" id="order-modal" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">ƒêi·ªÅn th√¥ng tin c√° nh√¢n</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                        </div>
                        <div class="modal-body">
                            <div class="container-fluid">
                                <div class="form-group">
                                    <div class="mb-3">
                                        <input type="text" class="form-control" id="order-name" placeholder="Nh·∫≠p h·ªç t√™n">
                                        <div id="nameError" class="form-text text-danger"></div>
                                    </div>

                                    <div class="mb-3">
                                        <input type="text" class="form-control" id="order-address" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
                                        <div id="addressError" class="form-text text-danger"></div>
                                    </div>

                                    <div class="mb-3">
                                        <input type="text" class="form-control" id="order-numphone" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i">
                                        <div id="numphoneError" class="form-text text-danger"></div>
                                    </div>
                                    <div id="msg" class="form-text text-danger"></div>  
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" onclick="closeModal()" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button type="button" onclick="order()" class="btn btn-primary">X√°c nh·∫≠n</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal -->
            <div class="modal fade" id="invoice" tabindex="-1" role="dialog" aria-labelledby="modelTitleId" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">H√≥a ƒë∆°n</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                        </div>
                        <div class="modal-body">
                            <div class="row ml-3 mt-2" id="invoice-name">
                                
                            </div>
                            <div class="row ml-3 mt-2" id="invoice-address">
                                
                            </div>
                            <div class="row ml-3 mt-2" id="invoice-numphone">
                                
                            </div>
                            <div class="row ml-3 mt-2" id="invoice-quantity">

                            </div>
                            <div class="row ml-3 mt-2" id="invoice-price">
                                
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">X√°c nh·∫≠n</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="supplier">
                <div class="supplier-form">
                    <div class="header">
                        <h5>ƒê·ªêI T√ÅC TI√äU BI·ªÇU</h5>
                        <img src="../img/item1.png">
                    </div>
                    <nav class="nav justify-content-center">
                      <a class="nav-link" id="bao" href="https://hanoimoi.vn/"><img src="../img/baoHN.png"></a>
                      <a class="nav-link" id="bao" href="https://ems.com.vn/"><img src="../img/baoEMS.png"></a>
                      <a class="nav-link" id="bao" href="https://nhandan.vn/"><img src="../img/baoND.png"></a>
                      <a class="nav-link" id="bao" href="https://thanhnien.vn/"><img src="../img/baoTN.png"></a>
                      <a class="nav-link" id="bao" href="https://tienphong.vn/"><img src="../img/baoTP.png"></a>
                      <a class="nav-link" id="bao" href="https://dantri.com.vn/"><img src="../img/baoDT.png"></a>
                    </nav>
                </div>
            </div>
        </div>

        <footer class="text-dark pt-4">
            <div class="container">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <h5>Gi·ªõi thi·ªáu chung</h5>
                  <p>Tr·ª• s·ªü c√¥ng ty: 66 Nhi√™u T·ª© ph∆∞·ªùng 7 qu·∫≠n Ph√∫ Nhu·∫≠n.</p>
                  <p>Ng√†nh ngh·ªÅ kinh doanh: ph√°t h√†nh b√°o ch√≠ v√† t·∫°p ch√≠ - B√°n bu√¥n, b√°n l·∫ª, ƒë·∫°i l√Ω b√°o ch√≠.</p>
                </div>
                <div class="col-md-4 mb-3">
                  <h5>Quy tr√¨nh - Ch√≠nh s√°ch</h5>
                  <ul class="list-unstyled">
                    <li><a href="#" class="text-dark">Ch√≠nh s√°ch thanh to√°n</a></li>
                    <li><a href="#" class="text-dark">Ch√≠nh s√°ch v·∫≠n chuy·ªÉn</a></li>
                    <li><a href="#" class="text-dark">Ch√≠nh s√°ch ƒë·ªïi tr·∫£</a></li>
                    <li><a href="#" class="text-dark">Ch√≠nh s√°ch b·∫£o h√†nh</a></li>
                  </ul>
                </div>
                <div class="col-md-4 mb-3">
                  <h5>ƒê·ªãa ch·ªâ li√™n h·ªá</h5>
                  <p>Email: tan2005tg@gmail.com</p>
                  <p>Phone: 034 9099 412</p>
                </div>
              </div>
              <nav class="nav justify-content-center">
                <a class="nav-link" href="#"><img src="../img/fb.png"></a>
                <a class="nav-link" href="#"><img src="../img/gmail.webp"></a>
                <a class="nav-link" href="#"><img src="../img/zl.webp"></a>
                <a class="nav-link" href="#"><img src="../img/twitter.png"></a>
              </nav>
              <div class="text-center py-3 border-top">
                ¬©2025 Thi·∫øt k·∫ø b·ªüi L√™ Minh T√¢n
              </div>
            </div>
          </footer>
    </div>
    <script>
        function register(){
            const username = document.getElementById("reg-username").value.trim();
            const password = document.getElementById("reg-password").value.trim();
            const repassword = document.getElementById("reg-repassword").value.trim();
            const address = document.getElementById("reg-address").value.trim();
            const email = document.getElementById("reg-email").value.trim();
            const numphone = document.getElementById("reg-numphone").value.trim();
            const msg = document.getElementById("register-msg");
            const name = document.getElementById("reg-name").value.trim();
            const regexNumPhone = /^(03|05|07|08|09)\d{8}$/;
            const regexPassword = /^.{6,}$/
            const regexEmail = /^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/;
            const addressRegex = /^[0-9]+[\/0-9\s]*.*$/
            if (!username || !password || !repassword || !email || !numphone || !name) {
                msg.innerHTML = '<span class="text-danger">Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!</span>';
                return;
            }
            else if(password != repassword){
                msg.innerHTML = '<span class="text-danger">M·∫≠t kh·∫©u nh·∫≠p l·∫°i kh√°c nhau!</span>';
                return;
            }
            else if(!regexNumPhone.test(numphone)){
                msg.innerHTML = '<span class="text-danger">S·ªë ƒëi·ªán tho·∫°i nh·∫≠p v√†o kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng</span>';
                return;
            }
            else if(!regexPassword.test(password)){
                msg.innerHTML = '<span class="text-danger">M·∫≠t kh·∫©u nh·∫≠p v√†o ph·∫£i tr√™n 5 k√≠ t·ª±</span>';
                return;
            }
            else if(!regexEmail.test(email)){
                msg.innerHTML = '<span class="text-danger">Email kh√¥ng h·ª£p l·ªá!</span>';
                return;
            }
            else if(!addressRegex.test(address)){
                msg.innerHTML = '<span class="text-danger">ƒê·ªãa ch·ªâ kh√¥ng h·ª£p l·ªá!</span>';
                return;
            }
            let users = JSON.parse(localStorage.getItem("users")) || [];
            const exists = users.find(u => u.username === username);
            if(exists){
                msg.innerHTML = '<span class="text-danger">T√†i kho·∫£n ƒë√£ t·ªìn t·∫°i!</span>';
                return;
            }
            const account = {
                username : "empty",
                password : "empty",
                numphone : 1,
                name : "empty",
                email : "empty",
                address: "empty"
            };
            account.username = username;
            account.name = name;
            account.password = password;
            account.email = email;
            account.numphone = numphone;
            account.address = address;
            users.push(account);
            localStorage.setItem("users", JSON.stringify(users));
            msg.innerHTML = '<span class="text-success">ƒêƒÉng k√Ω t√†i kho·∫£n th√†nh c√¥ng!</span>';
            document.getElementById("reg-username").value = "";
            document.getElementById("reg-password").value = "";
            document.getElementById("reg-repassword").value = "";
            document.getElementById("reg-numphone").value = "";
            document.getElementById("reg-email").value = "";
            document.getElementById("reg-name").value = "";
            document.getElementById("reg-address").value = "";
        }
        function login(){
            const username = document.getElementById("log-username").value.trim();
            const password = document.getElementById("log-password").value.trim();
            const msg = document.getElementById("log-msg");
            if(!username || !password){
                msg.innerHTML = '<span class="text-danger">Vui L√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!</span>';
                return;
            }
            let users = JSON.parse(localStorage.getItem("users")) || [];
            const validUser = users.find(u => u.username === username && u.password === password);
            if(validUser){
                localStorage.setItem("loggedInUser", username);
                alert("ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");
                $("#login").modal('hide');
                showDashboard(username);
                document.getElementById("log-username").value = "";
                document.getElementById("log-password").value = "";
            }
            else{
                msg.innerHTML = '<span class="text-danger">Sai t√™n ƒëƒÉng nh·∫≠p ho·∫∑c m·∫≠t kh·∫©u!</span>';
                document.getElementById("log-password").value = "";
            }
        }
        function showDashboard(username){
            document.getElementById("enter").style.display = "none";
            document.getElementById("signin").style.display = "none";
            document.getElementById("dashboard").style.display = "block";
            document.getElementById("welcome-user").textContent = username;
        }
        function logout(){
            localStorage.removeItem("loggedInUser");
            location.reload();
        }
        window.onload = function(){
            const loggedInUser = localStorage.getItem("loggedInUser");
            if(loggedInUser){
                showDashboard(loggedInUser);
            }
            showCart();
        };
        function closeModal(){
            document.getElementById("order-name").value = "";
            document.getElementById("order-address").value = "";
            document.getElementById("order-numphone").value = "";
            document.getElementById("nameError").textContent = "";
            document.getElementById("addressError").textContent = "";
            document.getElementById("numphoneError").textContent = "";
            document.getElementById("msg").textContent = "";
        };
        function order(){
            const name = document.getElementById("order-name");
            const address = document.getElementById("order-address");
            const numphone = document.getElementById("order-numphone");
            const msg = document.getElementById("msg");
            const nameText = name.value.trim();
            const addressText = address.value.trim();
            const numphoneText = numphone.value.trim();
            const nameError = document.getElementById("nameError");
            const addressError = document.getElementById("addressError");
            const numphoneError = document.getElementById("numphoneError");
            const nameRegex = /^[A-Za-z√Ä-·ª∏√†-·ªπ\s]+$/;
            const addressRegex = /^[0-9]+[\/0-9\s]*[A-Za-z√Ä-·ª∏√†-·ªπ\s]+.*$/
            const numphoneRegex = /^\d{10}$/;
            let valid = true;
            if(!nameRegex.test(nameText)){
                nameError.textContent = 'H·ªç t√™n kh√¥ng h·ª£p l·ªá';
                valid = false;
            }
            else{
                nameError.textContent = "";
            }
            if(!addressRegex.test(addressText)){
                addressError.textContent = "ƒê·ªãa ch·ªâ kh√¥ng h·ª£p l·ªá";
                valid = false
            }
            else{
                addressError.textContent = "";
            }
            if(!numphoneRegex.test(numphoneText)){
                valid = false;
                numphoneError.textContent = "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá";
            }
            else{
                numphoneError.textContent = "";
            }
            if(nameText == "" || addressText =="" || numphoneText == ""){
                valid = false;
                msg.textContent = "H√£y nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin";
            }
            else{
                msg.textContent = "";
            }
            if(valid){
                const user = {
                    name : "empty",
                    address : "empty",
                    numphone : "empty"
                };
                user.name = name.value;
                user.address = address.value;
                user.numphone = numphone.value;
                name.value = "";
                address.value = "";
                numphone.value = "";
                issueInvoice(user);
                document.getElementById("order-message").innerHTML = "üéâ ƒê·∫∑t h√†ng th√†nh c√¥ng! C·∫£m ∆°n b·∫°n ƒë√£ mua s·∫Øm.";
            }
        }
        function orderCart(){
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const loggedInUser = localStorage.getItem("loggedInUser");
            const message = document.getElementById("order-message");
            if (cart.length === 0) {
                message.style.color = "gray";
                message.textContent = "üõí Gi·ªè h√†ng hi·ªán ƒëang r·ªóng";
                return;
            }                     
            if(!loggedInUser){
                const modal = new bootstrap.Modal(document.getElementById("order-modal"));
                modal.show();
            }
            else{
                const users = JSON.parse(localStorage.getItem("users")) || [];
                let user;
                users.forEach(u => {
                    if(u.username == loggedInUser)
                        user = u;
                });
                document.getElementById("order-message").innerHTML = "üéâ ƒê·∫∑t h√†ng th√†nh c√¥ng! C·∫£m ∆°n b·∫°n ƒë√£ mua s·∫Øm.";
                issueInvoice(user);
            }
        };
        function issueInvoice(users){
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            let totalPrice = 0;
            let totalQuantity = 0;
            cart.forEach(product =>{
                totalPrice += parseInt(product.price) * parseInt(product.quantity);
                totalQuantity += parseInt(product.quantity);
            });
            const name = document.getElementById("invoice-name");
            const address = document.getElementById("invoice-address");
            const numphone = document.getElementById("invoice-numphone");
            const price = document.getElementById("invoice-price");
            const quantity = document.getElementById("invoice-quantity");
            name.innerHTML = "Kh√°ch h√†ng: " + users.name;
            address.innerHTML = "ƒê·ªãa ch·ªâ: " + users.address;
            numphone.innerHTML = "S·ªë ƒëi·ªán tho·∫°i: " + users.numphone;
            quantity.innerHTML = "S·ªë l∆∞·ª£ng ƒë∆°n h√†ng: " + totalQuantity;
            price.innerHTML = "T·ªïng gi√° tr·ªã ƒë∆°n h√†ng: " + totalPrice.toLocaleString("vi-VN") + "ƒë";
            const modal = new bootstrap.Modal(document.getElementById("invoice"));
            modal.show();
            localStorage.removeItem("cart");
            showCart();
        };
        function showCart() {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const container = document.getElementById("cart-list");
            container.innerHTML = "";
            cart.forEach(product => {
                const item = document.createElement("tr");
                item.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.price.toLocaleString("vi-VN")} ƒë</td>
                    <td>${product.quantity}</td>
                    <td><img src="${product.image}" alt="${product.name}" width="150" height="200" style="object-fit: cover; border: 1px solid #ccc;" /></td>
                `;
                container.appendChild(item);
            });
            const totalprice = document.getElementById("totalprice");
            let sum = 0;
            cart.forEach(element => {
                sum += parseInt(element.quantity) * parseInt(element.price);
            });
            totalprice.innerHTML = `${sum.toLocaleString("vi-VN") + " VNƒê"} `;
        };
    </script>
</body>
</html>